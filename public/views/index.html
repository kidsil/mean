<section data-ng-controller="IndexController">
  <div class="jumbotron masthead">
    <div class="masthead-caption container">
      <div class="row">
        <div class="col-md-8 col-md-offset-2">
          <h1>Dagu Wild Thumper</h1>
          <p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam hendrerit feugiat mauris a pharetra. Sed laoreet eleifend cursus. Nunc non mattis lorem.</p>
          <a class="btn btn-lg btn-primary" ng-click="scrollTo('thumperstream')">Try now!</a>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row sub-container">
      <div class="col-md-12">
        <div class="alert alert-info text-center">
          <p class="lead">Control the robot through the stream via the controls below.</p>
        </div>
      </div>
    </div>
    <div class="row sub-container">
      <div class="col-md-12">
        <div class="panel panel-default panel-controls">
          <div class="panel-body text-center">
            <object id ="thumperstream" width="100%" height="100%"> <param name="movie" value="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf"></param><param name="flashvars" value="src=rtmp%3A%2F%2F192.168.1.76%2Flive%2Ftest"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="470" height="320" flashvars="src=rtmp%3A%2F%2F192.168.2.189%2Flive%2Ftest"></embed></object>
           <!--  <object id="thumperstream" width="100%" height="100%"> <param name="movie" value="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf"></param><param name="flashvars" value="src=http%3A%2F%2Fosmf.org%2Fconfigurator%2Fvideos%2Fstrobe.flv"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="470" height="320" flashvars="src=http%3A%2F%2Fosmf.org%2Fconfigurator%2Fvideos%2Fstrobe.flv"></embed></object> -->
          </div>
        </div>
      </div>
    </div>
    <br />
    <div class="row sub-container">
      <div class="col-md-3">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <div class="row text-center">
              <button id="button_start" type="button" class="btn btn-success btn-lg button-key" onclick="start()">
                <span class="glyphicon glyphicon-flash"></span> Start (Z)
              </button>
            </div>
            <div class="button-separate"/>
            <div class="row text-center">
              <button id="button_stop" type="button" class="btn btn-danger btn-lg button-key" onclick="stop()">
                <span class="glyphicon glyphicon-ban-circle"></span> Stop (X)
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <div class="row text-center">
              <button id="button_shiftl" type="button" class="btn btn-info btn-lg button-key" onclick="shiftLeft()">
                <span class="glyphicon glyphicon-chevron-left"></span> Shift (Q)
              </button>
              <button id="button_up" type="button" class="btn btn-info btn-lg button-key" onclick="goForward()">
                <span class="glyphicon glyphicon-arrow-up"></span> Up (W)
              </button>              
              <button id="button_shiftr" type="button" class="btn btn-info btn-lg button-key" onclick="shiftRight()">
                <span class="glyphicon glyphicon-chevron-right"></span> Shift (E)
              </button>
            </div>
            <div class="button-separate"/>
            <div class="row text-center">
              <button id="button_left" type="button" class="btn btn-info btn-lg button-key" onclick="goLeft()">
                <span class="glyphicon glyphicon-arrow-left"></span> Left (A)
              </button>
              <button id="button_down" type="button" class="btn btn-info btn-lg button-key" onclick="goBackward()">
                <span class="glyphicon glyphicon-arrow-down"></span> Down (S)
              </button>
              <button id="button_right" type="button" class="btn btn-info btn-lg button-key" onclick="goRight()">
                <span class="glyphicon glyphicon-arrow-right"></span> Right (D)
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <div class="row text-center">
              <button id="button_jump" type="button" class="btn btn-primary btn-lg button-key" onclick="jump()">
                <span class="glyphicon glyphicon-leaf"></span> Jump (R)
              </button>
            </div>
            <div class="button-separate"/>
            <div class="row text-center">
              <button id="button_grab" type="button" class="btn btn-primary btn-lg button-key" onclick="grab()">
                <span class="glyphicon glyphicon-wrench"></span> Grab (F)
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br /><br />
  </div>
</section>

<script src='/socket.io/socket.io.js'></script>
<script>
  document.onkeydown = checkKey;
  function checkKey(e) {
    e = e || window.event;

    if (e.keyCode == '87') {
      $("#button_up").click();
      $("#button_up").addClass("active");
      setTimeout(function() { $("#button_up").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '83') {
      $("#button_down").click();
      $("#button_down").addClass("active");
      setTimeout(function() { $("#button_down").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '65') {
      $("#button_left").click();
      $("#button_left").addClass("active");
      setTimeout(function() { $("#button_left").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '68') {
      $("#button_right").click();
      $("#button_right").addClass("active");
      setTimeout(function() { $("#button_right").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '88') {
      $("#button_stop").click(); 
      $("#button_stop").addClass("active");
      setTimeout(function() { $("#button_stop").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '90') {
      $("#button_start").click(); 
      $("#button_start").addClass("active");
      setTimeout(function() { $("#button_start").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '82') {
      $("#button_jump").click(); 
      $("#button_jump").addClass("active");
      setTimeout(function() { $("#button_jump").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '70') {
      $("#button_grab").click(); 
      $("#button_grab").addClass("active");
      setTimeout(function() { $("#button_grab").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '69') {
      $("#button_shiftr").click(); 
      $("#button_shiftr").addClass("active");
      setTimeout(function() { $("#button_shiftr").removeClass("active"); }, 100);
    }
    else if (e.keyCode == '81') {
      $("#button_shiftl").click(); 
      $("#button_shiftl").addClass("active");
      setTimeout(function() { $("#button_shiftl").removeClass("active"); }, 100);
    }

  }

  function goForward() {
    socket.emit('clientToServer', 'forward');
    console.log('forward');
  }

  function goBackward() {
    socket.emit('clientToServer', 'backward');
    console.log('backward');
  }

  function goLeft() {
    socket.emit('clientToServer', 'left');
    console.log('left');
  }

  function goRight() {
    socket.emit('clientToServer', 'right');
    console.log('right');
  }

  function shiftLeft() {
    socket.emit('clientToServer', 'shiftl');
    console.log('shiftl');
  }

  function shiftRight() {
    socket.emit('clientToServer', 'shiftr');
    console.log('shiftr');
  }

  function stop() {
    socket.emit('clientToServer', 'stop');
    console.log('stop');
  }

  function start() {
    socket.emit('clientToServer', 'start');
    console.log('start');
  }

  function jump() {
    socket.emit('clientToServer', 'jump');
    console.log('jump');
  }

  function grab() {
    socket.emit('clientToServer', 'grab');
    console.log('grab');
  }

  var socket = io.connect('//localhost:3000');

  socket.on('hello', function(data) {
    socket.emit('clientType', 'PC Connected');
  });

  function getPanelWidth() { return ($("#thumperstream").width()); };
  $("#thumperstream").css({ height: (getPanelWidth() * 0.680851) });

  $(window).resize(function () {
    $("#thumperstream").css({ height: (getPanelWidth() * 0.680851) });
  });

</script>