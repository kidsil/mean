<section data-ng-controller="IndexController">
  <div class="section-1">
    <div class="container">
      <div class="row text-center">
        <div class="col-md-8 col-md-offset-2">
          <h1 class="text-center">Immersive Systems</h1>
          <p class="lead">See, navigate, and interact with the world from one of our robots.</p>
          <a class="btn btn-lg btn-primary" ng-click="scrollTo('controls')">Try now!</a>
        </div>
      </div>
      <br/><br/>
      <div class"row">
        <div class="col-md-12 text-right">
          A collaboration between:<br/>
          <img src="/img/images/sfu-logo.png" height="50px"/>
          <img src="/img/images/nserc-logo.png" height="50px"/>
        </div>
      </div>
    </div>
  </div>
  <div class="section-2">
    <div class="container text-center">
      <div class="row">
        <div class="col-md-6 col-md-offset-3 text-center">
          <h1>Giving you full control</h1>
        </div>
      </div>
      <br/>
      <div class="row">
        <div class="col-md-4">
          <i class="fa fa-eye fa-5x"></i>
          <h3>Immersive Systems</h1>
          <p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam hendrerit feugiat mauris a pharetra. Sed laoreet eleifend cursus. Nunc non mattis lorem.</p>
        </div>
        <div class="col-md-4">
          <i class="fa fa-road fa-5x"></i>
          <h3>Immersive Systems</h1>
          <p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam hendrerit feugiat mauris a pharetra. Sed laoreet eleifend cursus. Nunc non mattis lorem.</p>
        </div>
        <div class="col-md-4">
          <i class="fa fa-wrench fa-5x"></i>
          <h3>Immersive Systems</h1>
          <p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam hendrerit feugiat mauris a pharetra. Sed laoreet eleifend cursus. Nunc non mattis lorem.</p>
        </div>
      </div>
    </div>
  </div>
  <div id="controls" class="container">
    <div class="row sub-container">
      <div class="col-md-12 text-center">
        <div class="alert alert-info">
          <p class="lead">Control the robot through the stream via the controls below.</p>
        </div>
      </div>
    </div>
    <div class="row sub-container">
      <div class="col-md-12 text-center">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <object id ="thumperstream" width="100%" height="100%"> <param name="movie" value="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf"></param><param name="flashvars" value="src=rtmp%3A%2F%2F192.168.1.76%2Flive%2Ftest&streamType=live&optimizeBuffering=false&bufferTime=0&initialBufferTime=0&expandedBufferTime=0&liveBufferTime=0&minContinuousPlaybackTime=0"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="470" height="320" flashvars="src=rtmp%3A%2F%2F192.168.2.189%2Flive%2Ftest&streamType=live&optimizeBuffering=false&bufferTime=0&initialBufferTime=0&expandedBufferTime=0&liveBufferTime=0&minContinuousPlaybackTime=0"></embed></object>
           <!--  <object id="thumperstream" width="100%" height="100%"> <param name="movie" value="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf"></param><param name="flashvars" value="src=http%3A%2F%2Fosmf.org%2Fconfigurator%2Fvideos%2Fstrobe.flv"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="470" height="320" flashvars="src=http%3A%2F%2Fosmf.org%2Fconfigurator%2Fvideos%2Fstrobe.flv"></embed></object> -->
          </div>
        </div>
      </div>
    </div>
    <br />
    <div class="row sub-container">
      <div class="col-md-3">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <div class="row text-center">
              <button id="button_toggle" type="button" class="btn btn-success btn-lg button-key">
                <span class="glyphicon glyphicon-text-width"></span> Toggle (Z)
              </button>
            </div>
            <div class="button-separate"/>
            <div class="row text-center">
              <button id="button_stop" type="button" class="btn btn-danger btn-lg button-key">
                <span class="glyphicon glyphicon-ban-circle"></span> Stop (X)
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <div class="row text-center">
              <button id="button_shiftl" type="button" class="btn btn-info btn-lg button-key">
                <span class="glyphicon glyphicon-chevron-left"></span> Shift (Q)
              </button>
              <button id="button_up" type="button" class="btn btn-info btn-lg button-key">
                <span class="glyphicon glyphicon-arrow-up"></span> Up (W)
              </button>              
              <button id="button_shiftr" type="button" class="btn btn-info btn-lg button-key">
                <span class="glyphicon glyphicon-chevron-right"></span> Shift (E)
              </button>
            </div>
            <div class="button-separate"/>
            <div class="row text-center">
              <button id="button_left" type="button" class="btn btn-info btn-lg button-key">
                <span class="glyphicon glyphicon-arrow-left"></span> Left (A)
              </button>
              <button id="button_down" type="button" class="btn btn-info btn-lg button-key">
                <span class="glyphicon glyphicon-arrow-down"></span> Down (S)
              </button>
              <button id="button_right" type="button" class="btn btn-info btn-lg button-key">
                <span class="glyphicon glyphicon-arrow-right"></span> Right (D)
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="panel panel-default panel-controls">
          <div class="panel-body">
            <div class="row text-center">
              <button id="button_jump" type="button" class="btn btn-primary btn-lg button-key">
                <span class="glyphicon glyphicon-leaf"></span> Jump (R)
              </button>
            </div>
            <div class="button-separate"/>
            <div class="row text-center">
              <button id="button_grab" type="button" class="btn btn-primary btn-lg button-key">
                <span class="glyphicon glyphicon-wrench"></span> Grab (F)
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script src='/socket.io/socket.io.js'></script>
<script>
  var allowedForward = true;
  var allowedBackward = true;
  var allowedLeft = true;
  var allowedRight = true;
  var allowedShiftR = true;
  var allowedShiftL = true;
  var allowedToggle = true;
  var allowedStop = true;
  var allowedJump = true;
  var allowedGrab = true;

  document.onkeydown = checkKeyDown;
  function checkKeyDown(e) {
    e = e || window.event;

    if (e.keyCode == '87') {
      if (!allowedForward) return;
      allowedForward = false;
      forwardDown();
      $("#button_up").addClass("active");
    }
    else if (e.keyCode == '83') {
      if (!allowedBackward) return;
      allowedBackward = false;
      backwardDown();
      $("#button_down").addClass("active");
    }
    else if (e.keyCode == '65') {
      if (!allowedLeft) return;
      allowedLeft = false;
      leftDown();
      $("#button_left").addClass("active");
    }
    else if (e.keyCode == '68') {
      if (!allowedRight) return;
      allowedRight = false;
      rightDown();
      $("#button_right").addClass("active");
    }
    else if (e.keyCode == '88') {
      if (!allowedStop) return;
      allowedStop = false;
      stopDown();
      $("#button_stop").addClass("active");
    }
    else if (e.keyCode == '90') {
      if (!allowedToggle) return;
      allowedToggle = false;
      toggleDown();
      $("#button_toggle").addClass("active");
    }
    else if (e.keyCode == '82') {
      if (!allowedJump) return;
      allowedJump = false;
      jumpDown();
      $("#button_jump").addClass("active");
    }
    else if (e.keyCode == '70') {
      if (!allowedGrab) return;
      allowedGrab = false;
      grabDown();
      $("#button_grab").addClass("active");
    }
    else if (e.keyCode == '69') {
      if (!allowedShiftR) return;
      allowedShiftR = false;
      shiftRightDown();
      $("#button_shiftr").addClass("active");
    }
    else if (e.keyCode == '81') {
      if (!allowedShiftL) return;
      allowedShiftL = false;
      shiftLeftDown();
      $("#button_shiftl").addClass("active");
    }

  }

  document.onkeyup = checkKeyUp;
  function checkKeyUp(e) {
     e = e || window.event;

    if (e.keyCode == '87') {
      allowedForward = true;
      forwardUp();
      $("#button_up").removeClass("active");
    }
    else if (e.keyCode == '83') {
      allowedBackward = true;
      backwardUp();
      $("#button_down").removeClass("active");
    }
    else if (e.keyCode == '65') {
      allowedLeft = true;
      leftUp();
      $("#button_left").removeClass("active");
    }
    else if (e.keyCode == '68') {
      allowedRight = true;
      rightUp();
      $("#button_right").removeClass("active");
    }
    else if (e.keyCode == '88') {
      allowedStop = true;
      stopUp();
      $("#button_stop").removeClass("active");
    }
    else if (e.keyCode == '90') {
      allowedToggle = true;
      toggleUp();
      $("#button_toggle").removeClass("active");
    }
    else if (e.keyCode == '82') {
      allowedJump = true;
      jumpUp();
      $("#button_jump").removeClass("active");
    }
    else if (e.keyCode == '70') {
      allowedGrab = true;
      grabUp();
      $("#button_grab").removeClass("active");
    }
    else if (e.keyCode == '69') {
      allowedShiftR = true;
      shiftRightUp();
      $("#button_shiftr").removeClass("active");
    }
    else if (e.keyCode == '81') {
      allowedShiftL = true;
      shiftLeftUp();
      $("#button_shiftl").removeClass("active");
    }

  }

  $("#button_up").mousedown(forwardDown);
  $("#button_up").click(forwardUp);

  $("#button_down").mousedown(backwardDown);
  $("#button_down").click(backwardUp);

  $("#button_left").mousedown(leftDown);
  $("#button_left").click(leftUp);

  $("#button_right").mousedown(rightDown);
  $("#button_right").click(rightUp);

  $("#button_toggle").mousedown(toggleDown);
  $("#button_toggle").click(toggleUp);

  $("#button_stop").mousedown(stopDown);
  $("#button_stop").click(stopUp);

  $("#button_jump").mousedown(jumpDown);
  $("#button_jump").click(jumpUp);

  $("#button_grab").mousedown(grabDown);
  $("#button_grab").click(grabUp);

  $("#button_shiftr").mousedown(shiftRightDown);
  $("#button_shiftr").click(shiftRightUp);

  $("#button_shiftl").mousedown(shiftLeftDown);
  $("#button_shiftl").click(shiftLeftUp);

  function forwardDown() {
    socket.emit('clientToServer', 'forward');
    console.log('forward');
  }

  function forwardUp(){
    socket.emit('clientToServer', '-forward');
    console.log('-forward');
  }

  function backwardDown() {
    socket.emit('clientToServer', 'backward');
    console.log('backward');
  }

  function backwardUp() {
    socket.emit('clientToServer', '-backward');
    console.log('-backward');
  }

  function leftDown() {
    socket.emit('clientToServer', 'left');
    console.log('left');
  }

  function leftUp() {
    socket.emit('clientToServer', '-left');
    console.log('-left');
  }

  function rightDown() {
    socket.emit('clientToServer', 'right');
    console.log('right');
  }

  function rightUp() {
    socket.emit('clientToServer', '-right');
    console.log('-right');
  }

  function shiftLeftDown() {
    socket.emit('clientToServer', 'shiftl');
    console.log('shiftl');
  }

  function shiftLeftUp() {
    socket.emit('clientToServer', '-shiftl');
    console.log('-shiftl');
  }

  function shiftRightDown() {
    socket.emit('clientToServer', 'shiftr');
    console.log('shiftr');
  }

  function shiftRightUp() {
    socket.emit('clientToServer', '-shiftr');
    console.log('-shiftr');
  }

  function stopDown() {
    socket.emit('clientToServer', 'stop');
    console.log('stop');
  }

  function stopUp() {
    socket.emit('clientToServer', '-stop');
    console.log('-stop');
  }

  function toggleDown() {
    socket.emit('clientToServer', 'toggle');
    console.log('toggle');
  }

  function toggleUp() {
    // socket.emit('clientToServer', '-toggle');
    // console.log('-toggle');
  }

  function jumpDown() {
    socket.emit('clientToServer', 'jump');
    console.log('jump');
  }

  function jumpUp() {
    socket.emit('clientToServer', '-jump');
    console.log('-jump');
  }

  function grabDown() {
    socket.emit('clientToServer', 'grab');
    console.log('grab');
  }

  function grabUp() {
    socket.emit('clientToServer', '-grab');
    console.log('-grab');
  }

  var socket = io.connect('//localhost:3000');

  socket.on('hello', function(data) {
    socket.emit('clientType', 'PC Connected');
  });

  function getPanelWidth() { return ($("#thumperstream").width()); };
  $("#thumperstream").css({ height: (getPanelWidth() * 0.680851) });

  $(window).resize(function () {
    $("#thumperstream").css({ height: (getPanelWidth() * 0.680851) });
  });

</script>